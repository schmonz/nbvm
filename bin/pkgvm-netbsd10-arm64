#!/bin/sh

main() {
	QEMU_ARCH=aarch64
	QEMU_DISK=netbsd10-arm64.qcow2
	QEMU_PORT=2230
	QEMU_CPUS=4
	QEMU_RAMS=4096

	qemu-disk-create-if-needed "${QEMU_DISK}"

	exec qemu-system-${QEMU_ARCH} \
		-M virt,accel=hvf \
		-bios netbsd10-arm64-qemu-efi.fd \
		-cpu host \
		-smp ${QEMU_CPUS} \
		-m ${QEMU_RAMS} \
		-drive if=none,file=${QEMU_DISK},id=hd0 \
		-device virtio-blk-device,drive=hd0 \
		-nic user,model=virtio,hostfwd=tcp::${QEMU_PORT}-:22,ipv6=off \
		-device virtio-rng-pci \
		-nographic \
		"$@"
}

cd "$(dirname "$(realpath "$0")")"/../var/disks
main "$@"
exit $?

#!/bin/sh

set -e

opsys_specific_shutdown() {
	case "$(uname)" in
	Darwin|Linux)
		if [ -f /etc/alpine-release ]; then
			sudo poweroff
		else
			sudo shutdown -h now
		fi
		exit 0
		;;
	NetBSD|OpenBSD)
		sudo shutdown -hp now
		exit 0
		;;
	FreeBSD)
		sudo shutdown -p now
		exit 0
		;;
	SunOS)
		sudo shutdown -y -i 5 -g 0
		exit 0
		;;
	esac
}

main() {
	_myname=$(hostname | cut -d. -f1)

	if ! pkgbuild isvm; then
		echo >&2 "${_myname}: might be host, not shutting down"
		exit 5
	fi

	echo >&2 "${_myname}: shutting down"
	opsys_specific_shutdown
}

main "$@"
exit $?

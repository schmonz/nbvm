#!/bin/sh

set -e

main() {
	local pkgpath pkgname pkgcomment
	pkgpath=$(make show-var VARNAME=PKGPATH)
	pkgname=$(make show-var VARNAME=PKGBASE)
	pkgcomment=$(make show-var VARNAME=COMMENT)

	git init
	git add .
	git commit -m "Add pkgsrc ${pkgname} to git for offline hacking."
	mkdir .github
	cp ../../mail/qmail/.github/FUNDING.yml .github
	git add .github
	git commit -m "Add FUNDING.yml."
	gh repo create "pkgsrc-${pkgname}" --public --description "${pkgcomment}" --disable-wiki --homepage "https://pkgsrc.se/${pkgpath}"
	# would love to automate per-repo:
	# About -> gear icon -> Include in the home page
	# un-check Releases, Packages, and Environments
	git remote add origin "git@github.com:schmonz/pkgsrc-${pkgname}"
	git push -u origin main
}

main "$@"
exit $?

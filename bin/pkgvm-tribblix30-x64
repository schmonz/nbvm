#!/bin/sh

# post-install:
# cat >> /boot/loader.conf.local <<EOF
# console="ttya"
# verbose_loading="YES"
# autoboot_delay="3"
# beastie_disable="YES"
# EOF
# userdel -r jack
# passwd root
# useradd -g staff -m schmonz 
# zap install-overlay networked-system develop
# echo tribblix.pet-power-plant.local > /etc/nodename
# sed -e 's|tribblix.local|tribblix.pet-power-plant.local|g' \
#	< /etc/inet/hosts > /etc/inet/hosts.tmp \
#	&& mv /etc/inet/hosts.tmp /etc/inet/hosts
# echo "10.0.2.2:/Users/schmonz/trees	- /export/home/schmonz/trees	nfs	-	yes	bg" >> /etc/vfstab
# passwd schmonz
# login schmonz
# mkdir trees
# su
# reboot -p

main() {
	QEMU_ARCH=x86_64
	QEMU_DISK=tribblix30-x64.qcow2
	QEMU_PORT=4444
	QEMU_CPUS=1
	QEMU_RAMS=1536
	QEMU_ENET=02:c6:70:53:0d:94
	QEMU_MCNE=q35
	QEMU_BIOS=

	exec qemu-system-${QEMU_ARCH} \
		-machine ${QEMU_MCNE},accel=hvf,hpet=off \
		-smp ${QEMU_CPUS} \
		-m ${QEMU_RAMS} \
		-drive file=${QEMU_DISK},if=virtio,format=qcow2,index=0 \
		-nic user,mac=${QEMU_ENET},model=virtio,hostfwd=tcp::${QEMU_PORT}-:22,ipv6=off \
		-nographic \
		"$@"
}

cd "$(dirname "$(realpath "$0")")"/../var/disks
main "$@"
exit $?

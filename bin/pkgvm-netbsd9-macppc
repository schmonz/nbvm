#!/bin/sh

main() {
	QEMU_ARCH=ppc
	QEMU_DISK=netbsd9-macppc.qcow2
	QEMU_PORT=2224
	QEMU_CPUS=1
	QEMU_RAMS=1024
	QEMU_ENET=02:bd:a2:ce:2b:f1
	QEMU_EDRV=e1000
	QEMU_MCNE=mac99,via=pmu
	QEMU_BIOS=

	exec qemu-system-${QEMU_ARCH} \
		-machine ${QEMU_MCNE} \
		-smp ${QEMU_CPUS} \
		-m ${QEMU_RAMS} \
		-nographic \
		-nic user,mac=${QEMU_ENET},model=${QEMU_EDRV},hostfwd=tcp::${QEMU_PORT}-:22,ipv6=off \
		-prom-env 'boot-device=hd:,ofwboot.xcf;1' \
		-prom-env 'boot-file=netbsd' \
		-drive file=${QEMU_DISK},if=ide,format=qcow2,index=0 \
		"$@"
}

cd "$(dirname "$(realpath "$0")")"/../var/disks
main "$@"
exit $?

# https://www.reddit.com/r/BSD/comments/a0re4e/tip_to_install_netbsdmacppc_in_qemusystemppc/

#-prom-env 'auto-boot?=false'
#-usb -device usb-kbd -device usb-tablet \
#virtio-net-pci
#virtio-blk-pci

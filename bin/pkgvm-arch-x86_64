#!/bin/sh

# https://wiki.archlinux.org/title/working_with_the_serial_console#Syslinux

main() {
	QEMU_ARCH=x86_64
	QEMU_DISK=arch-x86_64.qcow2
	QEMU_PORT=5559
	QEMU_CPUS=1
	QEMU_RAMS=1024
	QEMU_ENET=02:38:19:45:e6:0d

	exec qemu-system-${QEMU_ARCH} \
		-machine type=q35,accel=hvf \
		-smp ${QEMU_CPUS} \
		-cpu host \
		-m ${QEMU_RAMS} \
		-device virtio-rng-pci \
		-nic user,mac=${QEMU_ENET},model=virtio,hostfwd=tcp::${QEMU_PORT}-:22,ipv6=off \
		-drive file=${QEMU_DISK},if=virtio,format=qcow2,index=0 \
		-nographic \
		"$@"
}

cd "$(dirname "$(realpath "$0")")"/../var/disks
main "$@"
exit $?
